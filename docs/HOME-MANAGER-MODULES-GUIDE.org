#+TITLE: Guia de Modulos Home Manager - Para Principiantes
#+AUTHOR: NixOS Guru
#+DATE: 2025-01-04
#+OPTIONS: toc:3 num:t
#+STARTUP: overview

* Que es esto y por que lo usamos
** La analogia: Plantillas vs Archivos copiados

Imagina que tienes una carta que envias a muchas personas. Tienes dos opciones:

*** Opcion 1: Copiar y pegar (el metodo Stow antiguo)

#+begin_example
Querido [nombre],
Te escribo desde [ciudad]...
#+end_example

Con Stow, tenias que:
1. Crear un archivo completo para cada maquina
2. Si cambias algo comun, editar TODOS los archivos
3. Facil olvidar actualizar alguno

*** Opcion 2: Usar una plantilla (Home Manager modules)

#+begin_example
Plantilla: "Querido ${nombre}, Te escribo desde ${ciudad}..."
Datos aurin: nombre="Juan", ciudad="Madrid"
Datos macbook: nombre="Juan", ciudad="Barcelona"
#+end_example

Con Home Manager modules:
1. Una plantilla define la ESTRUCTURA
2. Cada maquina solo dice sus VALORES
3. Nix genera el archivo final automaticamente

** Por que esto es mejor (con ejemplos reales)

*** Ejemplo 1: Cambiar el tamano de fuente

*Con Stow (antes):*
#+begin_src bash
# Tenias que editar CADA archivo de configuracion:
vim alacritty/.config/alacritty/alacritty.toml  # cambiar font.size = 14
vim xmobar/.config/xmobar/xmobarrc               # cambiar font size
# ... y asi con cada app en cada maquina
#+end_src

*Con Home Manager modules (ahora):*
#+begin_src nix
# Solo cambias UN numero en UN archivo:
# machines/aurin.nix
dotfiles.alacritty.fontSize = 16;  # Solo esto!
#+end_src

*** Ejemplo 2: Anadir un nuevo monitor a xmobar

*Con Stow (antes):*
- Editar xmobarrc de aurin
- Editar xmobarrc de macbook
- Editar xmobarrc de vespino
- Acordarte de hacerlo en todas

*Con Home Manager modules (ahora):*
- Editar UNA VEZ en =programs/xmobar.nix=
- Todas las maquinas lo tienen automaticamente

*** Ejemplo 3: Maquinas con hardware diferente

Tu macbook tiene HiDPI (pantalla retina), aurin tiene 96 DPI normal.

*Con Stow:* Dos archivos completamente diferentes, duplicando el 90% del codigo.

*Con Home Manager:*
#+begin_src nix
# machines/aurin.nix
dotfiles.alacritty.fontSize = 14;   # Monitor normal

# machines/macbook.nix
dotfiles.alacritty.fontSize = 18;   # HiDPI necesita mas grande
#+end_src

El resto de la configuracion (colores, keybindings, etc) es IDENTICO y no se duplica.

* Como funciona (paso a paso)
** Estructura de archivos (arbol visual)

#+begin_example
dotfiles/
+-- modules/
    +-- home-manager/
        |
        |-- default.nix              <- Punto de entrada (carga todo)
        |-- passh.nix                <- Config base del usuario
        |
        |-- programs/                <- PLANTILLAS de apps
        |   |-- alacritty.nix        <- Plantilla alacritty
        |   |-- xmobar.nix           <- Plantilla xmobar
        |   |-- picom.nix            <- (pendiente)
        |   |-- fish.nix             <- (pendiente)
        |   +-- xmonad.nix           <- (pendiente)
        |
        +-- machines/                <- VALORES por maquina
            |-- aurin.nix            <- Valores para aurin
            +-- macbook.nix          <- Valores para macbook
#+end_example

** El flujo: Como Nix genera tu configuracion

#+begin_example
                    +-------------------+
                    |  programs/*.nix   |
                    |   (PLANTILLAS)    |
                    |                   |
                    | Define OPCIONES:  |
                    | - fontSize        |
                    | - theme           |
                    | - gpuType         |
                    +--------+----------+
                             |
                             v
                    +-------------------+
                    | machines/*.nix    |
                    |    (VALORES)      |
                    |                   |
                    | Setea valores:    |
                    | fontSize = 14     |
                    | theme = "dark"    |
                    +--------+----------+
                             |
                             v
                    +-------------------+
                    |   NixOS rebuild   |
                    |                   |
                    | Combina plantilla |
                    | + valores         |
                    +--------+----------+
                             |
                             v
                    +-------------------+
                    | ARCHIVO GENERADO  |
                    |                   |
                    | ~/.config/app/... |
                    | (listo para usar) |
                    +-------------------+
#+end_example

** Ejemplo completo: Alacritty paso a paso

*** Paso 1: La PLANTILLA define que se puede cambiar

Archivo: =modules/home-manager/programs/alacritty.nix=

#+begin_src nix
# Este bloque DEFINE las opciones que puedes cambiar
options.dotfiles.alacritty = {

  # Opcion 1: tamano de fuente
  fontSize = lib.mkOption {
    type = lib.types.number;    # Es un numero
    default = 14;               # Si no dices nada, usa 14
    description = "Font size for Alacritty terminal";
  };

  # Opcion 2: tema de colores
  theme = lib.mkOption {
    type = lib.types.enum [ "dark" "light" ];  # Solo puede ser "dark" o "light"
    default = "dark";                           # Por defecto oscuro
    description = "Spacemacs color theme";
  };
};
#+end_src

*** Paso 2: La plantilla USA las opciones para generar config

Mas abajo en el mismo archivo:

#+begin_src nix
config = {
  programs.alacritty = {
    enable = true;
    settings = {
      font = {
        # Aqui USAMOS el valor de fontSize
        # cfg.fontSize se reemplaza por el numero que pusiste
        size = cfg.fontSize;
        normal.family = "Hack Nerd Font";
      };

      # Aqui USAMOS el tema para elegir colores
      colors = if cfg.theme == "dark" then {
        # Colores tema oscuro...
        primary.background = "#292b2e";
      } else {
        # Colores tema claro...
        primary.background = "#fbf8ef";
      };
    };
  };
};
#+end_src

*** Paso 3: Tu maquina SETEA los valores

Archivo: =modules/home-manager/machines/aurin.nix=

#+begin_src nix
{
  # Esto es TODO lo que necesitas escribir:
  dotfiles.alacritty = {
    fontSize = 14;      # Aurin tiene monitor normal
    theme = "dark";     # Prefiero tema oscuro
  };
}
#+end_src

Archivo: =modules/home-manager/machines/macbook.nix=

#+begin_src nix
{
  dotfiles.alacritty = {
    fontSize = 18;      # MacBook HiDPI necesita fuente mas grande
    theme = "dark";
  };
}
#+end_src

*** Paso 4: Nix genera el archivo final

Cuando haces =sudo nixos-rebuild switch=, Nix:

1. Lee la plantilla (=programs/alacritty.nix=)
2. Lee tus valores (=machines/aurin.nix=)
3. Combina todo
4. Genera =~/.config/alacritty/alacritty.toml= automaticamente

El archivo generado en aurin tendra:
#+begin_example
[font]
size = 14
...
#+end_example

El archivo generado en macbook tendra:
#+begin_example
[font]
size = 18
...
#+end_example

Y NO tuviste que escribir todo el archivo de configuracion!

* Como cambiar cosas (casos de uso reales)
** Caso 1: Quiero cambiar un valor en MI maquina

Por ejemplo: quieres que alacritty use fuente mas grande en aurin.

*** Que archivo editar

Solo el archivo de TU maquina:

#+begin_src bash
# Editar el archivo de valores de aurin:
emacs ~/dotfiles/modules/home-manager/machines/aurin.nix
#+end_src

*** Que cambiar

#+begin_src nix
{
  dotfiles.alacritty = {
    fontSize = 16;      # Cambiar de 14 a 16 (o el valor que quieras)
    theme = "dark";
  };
}
#+end_src

*** Como aplicar el cambio

#+begin_src bash
# Probar primero (no hace el cambio permanente):
sudo nixos-rebuild test

# Si funciona bien, aplicar permanentemente:
sudo nixos-rebuild switch
#+end_src

** Caso 2: Quiero anadir una nueva opcion para TODAS las maquinas

Por ejemplo: quieres poder elegir la familia de fuente (no solo el tamano).

*** Que archivo editar

El archivo de la PLANTILLA:

#+begin_src bash
emacs ~/dotfiles/modules/home-manager/programs/alacritty.nix
#+end_src

*** Paso 1: Anadir la nueva opcion

Busca la seccion =options.dotfiles.alacritty= y anade:

#+begin_src nix
options.dotfiles.alacritty = {
  fontSize = lib.mkOption {
    # ... (ya existe)
  };

  theme = lib.mkOption {
    # ... (ya existe)
  };

  # NUEVA OPCION:
  fontFamily = lib.mkOption {
    type = lib.types.str;                    # Es texto
    default = "Hack Nerd Font";              # Valor por defecto
    description = "Font family for terminal";
  };
};
#+end_src

*** Paso 2: Usar la nueva opcion en la configuracion

Busca donde se usa =font.normal.family= y cambia el valor fijo por =cfg.fontFamily=:

#+begin_src nix
config = {
  programs.alacritty.settings = {
    font = {
      size = cfg.fontSize;
      normal = {
        family = cfg.fontFamily;    # Antes: "Hack Nerd Font" (fijo)
        style = "Regular";          # Ahora: cfg.fontFamily (parametrizable)
      };
      bold.family = cfg.fontFamily;
      italic.family = cfg.fontFamily;
    };
  };
};
#+end_src

*** Paso 3: (Opcional) Setear valor diferente en una maquina

Si quieres una fuente diferente en macbook:

#+begin_src nix
# machines/macbook.nix
{
  dotfiles.alacritty = {
    fontSize = 18;
    theme = "dark";
    fontFamily = "JetBrains Mono";   # Solo en macbook
  };
}
#+end_src

Si NO pones nada, usara el default ("Hack Nerd Font").

** Caso 3: Quiero anadir una nueva app (ej: picom)

*** Paso 1: Crear el archivo de plantilla

#+begin_src bash
emacs ~/dotfiles/modules/home-manager/programs/picom.nix
#+end_src

Copia esta estructura base:

#+begin_src nix
# =============================================================================
# HOME-MANAGER: Picom Compositor
# =============================================================================
# Configuracion de Picom parametrizable por maquina
# =============================================================================

{ config, lib, pkgs, ... }:

let
  cfg = config.dotfiles.picom;   # Atajo para acceder a las opciones
in
{
  # 1. DEFINIR OPCIONES (que se puede cambiar)
  options.dotfiles.picom = {
    enable = lib.mkEnableOption "Picom compositor";

    # Ejemplo de opcion booleana
    vsync = lib.mkOption {
      type = lib.types.bool;
      default = true;
      description = "Enable vsync";
    };

    # Ejemplo de opcion numerica
    shadowRadius = lib.mkOption {
      type = lib.types.int;
      default = 12;
      description = "Shadow radius in pixels";
    };

    # Ejemplo de opcion texto
    backend = lib.mkOption {
      type = lib.types.enum [ "glx" "xrender" "xr_glx_hybrid" ];
      default = "glx";
      description = "Rendering backend";
    };
  };

  # 2. USAR LAS OPCIONES (generar configuracion)
  config = lib.mkIf cfg.enable {
    # Usar el modulo nativo de home-manager para picom
    services.picom = {
      enable = true;
      vSync = cfg.vsync;
      shadow = true;
      shadowOffsets = [ (-7) (-7) ];
      # ... mas configuracion usando cfg.algo
    };
  };
}
#+end_src

*** Paso 2: Registrar el modulo en default.nix

#+begin_src bash
emacs ~/dotfiles/modules/home-manager/default.nix
#+end_src

Anadir la linea de import:

#+begin_src nix
{
  imports = [
    ./passh.nix
    ./programs/xmobar.nix
    ./programs/alacritty.nix
    ./programs/picom.nix           # <- ANADIR ESTA LINEA
  ] ++ lib.optionals machineExists [ machineConfig ];
}
#+end_src

*** Paso 3: Configurar en tus maquinas

#+begin_src nix
# machines/aurin.nix
{
  dotfiles.picom = {
    enable = true;
    vsync = true;
    backend = "glx";          # NVIDIA funciona bien con GLX
    shadowRadius = 12;
  };
}
#+end_src

*** Paso 4: Aplicar

#+begin_src bash
sudo nixos-rebuild test && sudo nixos-rebuild switch
#+end_src

* Errores comunes y como solucionarlos
** Error: "option X does not exist"

*** Que significa

Intentaste usar una opcion que no esta definida.

*** Ejemplo del error

#+begin_example
error: The option `dotfiles.alacritty.fontFamily' does not exist.
#+end_example

*** Causa mas comun

Escribiste mal el nombre de la opcion, o la opcion no existe todavia.

*** Como solucionarlo

1. Verifica que escribiste bien el nombre (fontFamily vs fontfamily)
2. Si la opcion no existe, anadela en =programs/alacritty.nix= (ver Caso 2 arriba)

** Error: "infinite recursion encountered"

*** Que significa

Nix detecto un ciclo: A depende de B, B depende de A.

*** Causa mas comun

Usaste =config.algo= donde debias usar =cfg.algo= en el let.

*** Ejemplo malo vs bueno

#+begin_src nix
# MAL - causa recursion infinita:
let
  cfg = config.dotfiles.picom;
in {
  options.dotfiles.picom.backend = lib.mkOption {
    default = config.dotfiles.picom.vsync;  # ERROR: usando config dentro de options
  };
}

# BIEN:
let
  cfg = config.dotfiles.picom;
in {
  options.dotfiles.picom.backend = lib.mkOption {
    default = "glx";   # Valor simple, no referencia a config
  };
}
#+end_src

*** Como solucionarlo

- En la seccion =options=: usa valores simples (strings, numeros, booleans)
- En la seccion =config=: ahi SI puedes usar =cfg.algo=

** Error: "syntax error, unexpected..."

*** Que significa

Hay un error de sintaxis en tu codigo Nix.

*** Causas comunes

1. Falta un punto y coma (;) al final de una linea
2. Falta cerrar una llave (}) o corchete (])
3. Falta una coma en una lista

*** Como encontrar el error

El mensaje te dice la linea aproximada:

#+begin_example
error: syntax error, unexpected '}', expecting ';'
       at /home/passh/dotfiles/modules/home-manager/programs/picom.nix:42:1
#+end_example

Mira la linea 42 y las anteriores.

*** Tips de sintaxis Nix

#+begin_src nix
# Atributos terminan en punto y coma:
{
  nombre = "valor";   # <- punto y coma
  otro = 123;         # <- punto y coma
}

# Listas usan espacios, NO comas:
[ "uno" "dos" "tres" ]   # <- sin comas entre elementos

# Strings multilinea usan '' (dos comillas simples):
texto = ''
  Linea 1
  Linea 2
'';

# Interpolacion de variables usa ${...}:
mensaje = "Hola ${nombre}";
#+end_src

** Como ver que archivo genero Nix

A veces quieres ver el archivo final que Nix genero.

*** Ver configuracion de alacritty

#+begin_src bash
cat ~/.config/alacritty/alacritty.toml
#+end_src

*** Ver configuracion de xmobar

#+begin_src bash
cat ~/.config/xmobar/xmobarrc
#+end_src

*** Ver donde apunta un symlink

#+begin_src bash
ls -la ~/.config/alacritty/
# Mostrara algo como:
# alacritty.toml -> /nix/store/xxx.../alacritty.toml
#+end_src

*** Ver todos los archivos generados por home-manager

#+begin_src bash
# En el Nix store:
ls -la /nix/var/nix/profiles/per-user/passh/home-manager/home-files/.config/
#+end_src

* Ejemplos completos
** Ejemplo 1: Alacritty (sencillo, 2 opciones)

Este es el ejemplo mas simple. Solo tiene dos opciones parametrizables.

*** Archivo completo: programs/alacritty.nix

#+begin_src nix
# =============================================================================
# HOME-MANAGER: Alacritty Terminal Emulator
# =============================================================================
{ config, lib, pkgs, ... }:

let
  # cfg es un ATAJO para no escribir config.dotfiles.alacritty todo el rato
  cfg = config.dotfiles.alacritty;
in
{
  # PARTE 1: DEFINIR OPCIONES
  # Aqui dices QUE se puede cambiar
  options.dotfiles.alacritty = {

    fontSize = lib.mkOption {
      type = lib.types.number;    # Acepta numeros (14, 16, 18.5, etc)
      default = 14;               # Si no especificas, usa 14
      description = "Font size for Alacritty terminal";
    };

    theme = lib.mkOption {
      type = lib.types.enum [ "dark" "light" ];  # Solo estos dos valores
      default = "dark";
      description = "Spacemacs color theme (dark or light)";
    };
  };

  # PARTE 2: USAR LAS OPCIONES
  # Aqui usas cfg.fontSize y cfg.theme para generar la config
  config = {
    programs.alacritty = {
      enable = true;

      settings = {
        font = {
          size = cfg.fontSize;           # <- USA el valor de fontSize
          normal.family = "Hack Nerd Font";
        };

        # Usa if/then/else para elegir colores segun el tema
        colors = if cfg.theme == "dark" then {
          primary.background = "#292b2e";
          primary.foreground = "#b2b2b2";
          # ... mas colores oscuros
        } else {
          primary.background = "#fbf8ef";
          primary.foreground = "#655370";
          # ... mas colores claros
        };
      };
    };
  };
}
#+end_src

*** Uso en machines/aurin.nix

#+begin_src nix
{
  dotfiles.alacritty = {
    fontSize = 14;
    theme = "dark";
  };
}
#+end_src

** Ejemplo 2: XMobar (complejo, muchas opciones)

XMobar tiene muchas opciones porque cada maquina tiene hardware diferente.

*** Opciones disponibles

| Opcion           | Tipo            | Default   | Descripcion                      |
|------------------+-----------------+-----------+----------------------------------|
| enable           | bool            | false     | Activar xmobar                   |
| fontSize         | int             | 16        | Tamano de fuente                 |
| gpuType          | enum            | "none"    | nvidia, intel, o none            |
| networkInterface | string o null   | null      | Interfaz ethernet (ej: enp10s0)  |
| wifiInterface    | string o null   | null      | Interfaz wifi (ej: wlp8s5)       |
| showBattery      | bool            | false     | Mostrar bateria (laptops)        |
| showNvmeMonitor  | bool            | false     | Mostrar monitor NVMe             |
| showTrayer       | bool            | true      | Mostrar bandeja sistema          |
| alsaMixer        | string o null   | "Master"  | Mixer de audio                   |

*** Ejemplo de uso condicional en la plantilla

#+begin_src nix
# En programs/xmobar.nix, el template se genera condicionalmente:

template = "
  ${lib.optionalString (cfg.gpuType != "none") "%gpu%"}
  ${lib.optionalString (cfg.networkInterface != null) "%${cfg.networkInterface}%"}
  ${lib.optionalString cfg.showBattery "%battery%"}
"
#+end_src

=lib.optionalString= significa:
- Si la condicion es true: incluir el texto
- Si la condicion es false: no incluir nada

*** Configuracion aurin (desktop con NVIDIA)

#+begin_src nix
# machines/aurin.nix
{
  dotfiles.xmobar = {
    enable = true;
    fontSize = 16;              # Monitor 96 DPI
    gpuType = "nvidia";         # RTX 5080
    networkInterface = "enp10s0";
    wifiInterface = "wlp8s5";
    showBattery = false;        # Desktop, no hay bateria
    showNvmeMonitor = true;
  };
}
#+end_src

*** Configuracion macbook (laptop con Intel)

#+begin_src nix
# machines/macbook.nix
{
  dotfiles.xmobar = {
    enable = true;
    fontSize = 24;              # HiDPI 168 DPI, necesita mas grande
    gpuType = "intel";          # Intel integrada
    networkInterface = null;    # Sin ethernet
    wifiInterface = "wlp0s20f0u7";
    showBattery = true;         # Laptop, mostrar bateria!
    showNvmeMonitor = false;
    showTrayer = false;
    alsaMixer = "PCM";          # MacBook usa PCM, no Master
  };
}
#+end_src

** Ejemplo 3: Plantilla vacia para nueva app

Copia esto como punto de partida para cualquier app nueva:

#+begin_src nix
# =============================================================================
# HOME-MANAGER: [NOMBRE DE LA APP]
# =============================================================================
# Descripcion breve de que hace esta app
#
# USO:
#   dotfiles.nombreapp = {
#     enable = true;
#     opcion1 = "valor";
#   };
# =============================================================================

{ config, lib, pkgs, ... }:

let
  cfg = config.dotfiles.nombreapp;
in
{
  # ------------------------------------------
  # OPCIONES: Define que se puede configurar
  # ------------------------------------------
  options.dotfiles.nombreapp = {

    # Opcion para activar/desactivar
    enable = lib.mkEnableOption "Nombre de la app";

    # Opcion tipo texto
    opcionTexto = lib.mkOption {
      type = lib.types.str;
      default = "valor por defecto";
      description = "Descripcion de esta opcion";
    };

    # Opcion tipo numero entero
    opcionNumero = lib.mkOption {
      type = lib.types.int;
      default = 10;
      description = "Descripcion de esta opcion";
    };

    # Opcion tipo booleano
    opcionBool = lib.mkOption {
      type = lib.types.bool;
      default = true;
      description = "Descripcion de esta opcion";
    };

    # Opcion tipo enum (lista de valores permitidos)
    opcionEnum = lib.mkOption {
      type = lib.types.enum [ "valor1" "valor2" "valor3" ];
      default = "valor1";
      description = "Descripcion de esta opcion";
    };

    # Opcion opcional (puede ser null)
    opcionOpcional = lib.mkOption {
      type = lib.types.nullOr lib.types.str;
      default = null;
      description = "Descripcion (null para desactivar)";
    };
  };

  # ------------------------------------------
  # CONFIG: Usa las opciones para generar algo
  # ------------------------------------------
  config = lib.mkIf cfg.enable {

    # Opcion A: Usar modulo nativo de home-manager si existe
    # (buscar en https://nix-community.github.io/home-manager/options.html)
    # programs.nombreapp = {
    #   enable = true;
    #   settings.algo = cfg.opcionTexto;
    # };

    # Opcion B: Generar archivo de configuracion directamente
    xdg.configFile."nombreapp/config".text = ''
      # Archivo generado por Nix
      opcion1 = ${cfg.opcionTexto}
      opcion2 = ${toString cfg.opcionNumero}
      ${lib.optionalString (cfg.opcionOpcional != null) "opcion3 = ${cfg.opcionOpcional}"}
    '';

    # Opcion C: Instalar el paquete
    home.packages = [ pkgs.nombreapp ];
  };
}
#+end_src

* Comandos utiles
** Aplicar cambios

#+begin_src bash
# SIEMPRE probar primero (cambio temporal):
sudo nixos-rebuild test

# Si funciona, aplicar permanentemente:
sudo nixos-rebuild switch
#+end_src

** Ver que generaria sin aplicar

#+begin_src bash
# Dry-run: muestra que haria sin hacerlo
sudo nixos-rebuild dry-build

# Ver el resultado en el store
sudo nixos-rebuild build
#+end_src

** Rollback (deshacer cambios)

#+begin_src bash
# Volver a la configuracion anterior:
sudo nixos-rebuild switch --rollback

# Ver lista de generaciones disponibles:
sudo nix-env --list-generations --profile /nix/var/nix/profiles/system
#+end_src

** Ver configuracion generada

#+begin_src bash
# Alacritty:
cat ~/.config/alacritty/alacritty.toml

# XMobar:
cat ~/.config/xmobar/xmobarrc

# Ver como symlink:
ls -la ~/.config/alacritty/
#+end_src

** Verificar sintaxis sin aplicar

#+begin_src bash
# Verificar que el Nix no tiene errores de sintaxis:
nix-instantiate --parse ~/dotfiles/modules/home-manager/programs/alacritty.nix
#+end_src

** Buscar opciones de home-manager

#+begin_src bash
# Ver opciones disponibles en home-manager:
man home-configuration.nix

# O buscar en la web:
# https://nix-community.github.io/home-manager/options.html
#+end_src

* Referencia rapida
** Tipos de opciones mas comunes

| Tipo                            | Que acepta              | Ejemplo                     |
|---------------------------------+-------------------------+-----------------------------|
| lib.types.str                   | Texto                   | "hola"                      |
| lib.types.int                   | Numero entero           | 42                          |
| lib.types.number                | Numero (incluye decimal)| 3.14                        |
| lib.types.bool                  | true o false            | true                        |
| lib.types.enum [ "a" "b" ]      | Solo esos valores       | "a"                         |
| lib.types.nullOr lib.types.str  | Texto o null            | "algo" o null               |
| lib.types.listOf lib.types.str  | Lista de textos         | [ "a" "b" "c" ]             |

** Funciones utiles

| Funcion                         | Que hace                                    |
|---------------------------------+---------------------------------------------|
| lib.mkOption { ... }            | Define una opcion                           |
| lib.mkEnableOption "desc"       | Crea opcion enable = true/false             |
| lib.mkIf condicion { ... }      | Solo incluir si condicion es true           |
| lib.optionalString cond "text"  | Texto si true, "" si false                  |
| toString valor                  | Convierte numero a texto                    |
| lib.mkDefault valor             | Valor default que puede sobreescribirse     |

** Estructura minima de un modulo

#+begin_src nix
{ config, lib, pkgs, ... }:

let
  cfg = config.dotfiles.NOMBRE;
in
{
  options.dotfiles.NOMBRE = {
    # Definir opciones aqui
  };

  config = lib.mkIf cfg.enable {
    # Usar opciones aqui
  };
}
#+end_src

* Estado actual de la migracion

| App        | Estado      | Archivo                        | Opciones               |
|------------+-------------+--------------------------------+------------------------|
| xmobar     | COMPLETADO  | programs/xmobar.nix            | 9 opciones             |
| alacritty  | COMPLETADO  | programs/alacritty.nix         | 2 opciones             |
| picom      | PENDIENTE   | programs/picom.nix (crear)     | -                      |
| fish       | PENDIENTE   | programs/fish.nix (crear)      | -                      |
| xmonad     | PENDIENTE   | programs/xmonad.nix (crear)    | -                      |
| doom emacs | PENDIENTE   | programs/doom-emacs.nix (crear)| -                      |

** Proximo paso recomendado

1. Migrar picom (compositor, relativamente simple)
2. Migrar fish (shell, mas opciones)
3. Migrar xmonad (WM, el mas complejo)
4. Eliminar el hack de Stow cuando todo este migrado

* Glosario para principiantes

- *Modulo*: Un archivo .nix que define opciones y configuracion
- *Opcion*: Un valor que puedes cambiar (como fontSize)
- *Plantilla*: El archivo en programs/*.nix que define la estructura
- *cfg*: Atajo comun para acceder a tus opciones (cfg.fontSize)
- *lib*: Biblioteca de funciones utiles de Nix
- *mkOption*: Funcion para crear una opcion configurable
- *mkIf*: Condicional - solo incluir si la condicion es true
- *enable*: Opcion especial para activar/desactivar un modulo
- *Nix store*: Donde Nix guarda todos los archivos generados (/nix/store/)
- *Generacion*: Una version de tu configuracion (puedes volver atras)
- *Rebuild*: Reconstruir el sistema con la nueva configuracion
- *Stow*: La herramienta antigua para symlinks (estamos reemplazandola)
